{% load menu_tags %}

<ul class="menu">
    {% for item in root_items %}
        <li class="menu-item {% if item.id in active_items %}active{% endif %}">
            <a href="{{ item.get_absolute_url }}" 
               {% if item.get_absolute_url == current_path %}class="current"{% endif %}>
                {{ item.name }}
            </a>
            {% if item.id in active_items %}
                {% with children=menu_tree|get_item:item.id %}
                    {% if children %}
                        <ul class="submenu">
                            {% for child in children %}
                                <li>
                                    <a href="{{ child.get_absolute_url }}"
                                       {% if child.get_absolute_url == current_path %}class="current"{% endif %}>
                                        {{ child.name }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endwith %}
            {% endif %}
        </li>
    {% endfor %}
</ul>
